Проект MockupApp
-----------------------------------------------------------------
Кратко о сути:
Проект подразумевает веб приложение, которое позволяет используя готовые  мокапы, изображения пользователя и элементы графического редактора(рисование, перемещение, масштабирование, окраску) - создавать видео(как с альфа каналом для веб так и без оного)  и как частный случай скрин одного кадра в png.

В целях ускорения процесса и получения продакшен версии, было принято решение временно обрезать максимальный функционал до уровня:

- клиент выбирает готовый мокап,
- клиент может менять изображение\видео в каждом из мокапов (если их много),
- клиент может менят фон (заливка, градиент, изображение),
- клиент может накладывать фильтры,
- клиент использует простой вид сайдбара для управления всем этим функционалом
- клиент может менять результирующее разрешение для экспорта видео
- клиент может экспортировать видео с альфа\без и png
- клиент может перемещать рабочую область SPACE-LeftClick
- клиент может масштабировать рабочую область колесом мыши

Это основные блоки которые в той или иной мере используются в релизе

Помимо этого, в отключенном виде (т.е. или комментарии, или display:none(для шаблона), или отсутсвие вызова того или иного метода) находятся сделующие элементы:

- расширенный сайдбар (справа)
- выделение конкретного мокапа и возможность его перемещения в пределах рабочей области
- методы отвечающие за определение размера мокапа для выделения
- методы отвечающие за панель инструментов графического редактора
- рисование бизье
- рисование примитивов (круг, прямоугольник, прямоугольник с закругленными краями,  звезда)
- большинство методов отвечающих за горячие клавиши в тех или иных ситуациях (например при рисовании примитивов, аналог Photoshop)
- также закоментировано ряд тенических решений, находящихся в статусе "проверки" 

-----------------------------------------------------------------

О технической стороне дела:

Сразу возникший вопрос: в проекте не используется WebPack\SSR по ряду причин в основном связанных со спецификой работы с Pixi.js. Если разработчик начнет работать он поймет :)
Коротко говоря - учитывая часто меняющийся функционал и особенности сильной зависимости от ресурсов клиента исправлять в живую - более оперативно, хотя в продакшен версии это лучше всего собрать уже как SSR.

Итак, как это работает внутри:

Для серверной части используется:
- express.io для быстрой организации http сервера
- connect-history-api-fallback для организации аналога mod_rewrite (необходимо в случаях с чтением списков мокапов и в вариантах прегенерацией нужного разрешения изображений)
- pm2 для запуска самого проекта

pm2 restart app - рестарт
pm2 log - просмотр лога серверной части

ПО СЕРВЕРНОЙ ЧАСТИ (структура)

/public - тут вся статика в том числе js логика
/routes - тут скипты отвечающие за API взаимодействия с сервером (роуты, пути за получения данных)
      --index.js   - основной роут, обслушивающий / , внутри ничего интересного
      --sceneslist.js - роут обслущивающий запрос вида /api/sceneslist , результатом является json с данными о сценах в папке /public/scenes
      --scenesid.js - роут обслуживающий запрос вида /api/scenes/:id , id в данном случае идентификатор сцены, он к нам из верхнего роута доходит. Результатом является json с детальными данными самой сцены (в отличии от верхнего роута мы читаем тут данные о каждом кадре, координатах, и т.д.)
      --pngtransform.js - роут обслуживающий обращения вида /scenes/:width/:height/device\:name.png - по сути сут роута в следующем: изначально у нас есть сцена и  в сцене есть базовый набор мокапов в 4к разрешении. Работать с 4к разрешением в случаях с 2к или HD крайне ресурсоемко, потому в зависимости от указанных :width :height мы проверяем есть ли такие , если нет то их генерим (используется модуль imagemagick для качественного ресайза)
      --getgradientlist.js  -  роут /api/gradientlist, на выходе json данные о градиентах в папке /public/store/gradients, роут по сути парсит находящиеся там svg и преобразует из в более понятные данные которые потом используются в canvas
      --exportvideo.js - роут для /api/exportvideo/ нужен для экспорта видео. Входящие данные передаются через POST\GET. Передача идет покадрово. Сами кадры рендеряться на клиента. Использует FFMpeg для данной операции. На выходе ссылка на собранное видео.
      --downloader.js - ОТСУТСТВУЕТ ФУНКЦИОНАЛ (используется для теста)

/views - внутри по сути два html шаблона 
      -- index.html - для основного приложения
      -- error.html - для ошибкок 

/app.js  - основной файл с которого все начинается
/config.js - немного конфигурации

ПО КЛИЕНТСКОЙ ЧАСТИ (структура)
Вся клиентская часть у нас в папке /public/ (ну кроме шаблона из папки /views/)
/store  - папка для хранения доп элементов (пока там только градиенты, но технически могут быть еще элементы)
      --/gradients/ - тут лежать просто SVG файлы которые используются для предгенереных градиентов и по совместительству для информации по данным градиентам 
/scenes - собственно сами сцены (подробнее ниже)
/images - общие картинки которые используются ТОЛЬКО в шаблонах которые собраны отдельно на стороне Руслана (технически должны быть в папке assets но изначально так приходят шаблоны потому не менял)
/export - рабочая папка в которой генерятся видео файлы (подробнее ниже)
/assets - непосредственно вся логика front-end (подробнее ниже)
... файлы в корне папки /public (кроме favicon.ico) нужны для более быстрого теста функционала ...(т.е. технически это можно удалить, убедившись что на них нет ссылок)


ОПИСАНИЕ scenes

Сразу оговорюсь что АКТУАЛЬНАЯ версия РАБОЧЕЙ сцены лежит ТОЛЬКО в папке 0TestMockup, все остальные папки могут!!!!!! содержать неврный конфиг или файлы, вызывая сбой загрузки.

Структура
<имя папки, по совместительству ID сцены>, внутри
  - /1,2,3,4,5 и т.д. папки содержащие данные о конкретном мокапе (слое) в сцене 
		-- coordinates - данные по координатам 
					LowerLeft... и т.д. json файлы содержащие координаты соотвествующего угла маски на каждый кадр
					Offset - данные по смещению (есть два варианта совмещения координат маски с реальным изображением - текущий используемый использование смещения, 2й - расчет его по факту)
		-- device - изображения на каждый из кадров мокапа(слоя)
		  данные в папках вида 1920 и т.д. это данные генерируемые из исходных изображений в корне через роут pngtransform.js	для последующего использования в более младших разрешениях (привязка идет только по ширине, так как высота у нас всегда будет пропорциональной)
    -- mask\mask.png - хранит маску в 4к разрешении (в будущем для того чтобы появился antialiasing нужно преобразовывать маску для более низких разрешений подобно устройству выше)
    icon.png - иконка для полного сайдбара на данный слой
    screen.jpg - стартовая заглушка для изображения внутри мокапа. Используется и как заглушка и как шаблон для определения пропорций заливаемых пользователем изображений
    layer_settings - json конфиг для текущего слоя вида

    {
				"name": "iPhone X"  - пока(!!!) содержит только имя для слоя
    }


  - /preview - сиквенс который используется для генерации псевдовидео в общем списке сцена
  - settings -общие настройки всей сцены
     внутри json файл вида

     {
		"name":"Test mockup",      - название сцены
		"loop":false,                - наличие у сцены зацикленности (т.е. конец плавно перетекает в начало)
		"background-type" : "linear",   - тип заливки фона
		"background-color" : ["0","9B9BA0","0.5","CACACA","1","CACACA"],  - данные по заливке на конкретный тип (повторяют параметры для canvas)
		"background-orientation" : [0, 2160, 4096, 0], - ориентация заливки (повторяет канвас)
		"width":4096,  - непосредственная ширина мокапа (теоретически конечное разрешение может отличаться!!!)
		"height":2160,  - непосредственная высота
		"blendmode" : "SCREEN" - тип наложения для слоя  с бликом
     }


ОПИСАНИЕ export

в папке для каждого запроса экспорта видео генерируется рандомная хеш папка
внутрь аплоадяться покадрово файлы отрендереные на клиенте
затем они в зависимости от типа сборки ffmpeg  генеряться в файл вида movie_<имя_сцены>.mp4
помимо этого могут быть еще доп. mp4 файлы которые там образуются как промежуточный вариант работы ffmpeg


ОПИСАНИЕ assets
/components - сторонние компоненты которы используются в проекте
/themes/default - тут хранияться стили
---- normalize.css  -нормализатор стилей
---- fonts.css - шрифт используемый для кастомных иконок
---- index.css - базовый стиль от elements.io (без изменений)
---- mockupapp.webflow.css - стили которые используются в шаблонах созданных на стороне Руслана
---- overload.css собственно ОСНОВНЫЕ РАОЧИЕ стили приложения, которые или определяют или переопределяют вышеозначенные

в корне лежат js файлы в той или иной мере отвечающие за функционал

основной стек Vue.js - vue-router - vuex - pixi.js

все файлы - являются частью одного целого и подключаются как примеси (Mixins) 


По сути в проекте используется 3 основных компонента
- основной (т.е. базовый скрипт - core.js)
- компонент отвечающий за рабочую область (sceneeditor.js)
- компонент отвечающий за общий список сцен (sceneload.js)

остальное примеси которые являются частью данных компонентов

definitions.js - в актуальной версии храниться только перечень типо наложения слоя
exporter.js - все что непосредствнно относиться к экспорту видео и изображений
helpers.js - все что относится к выделению слоя бегущим пунктиром 
keyevents.js - обработка событий с клавиатуры
mouseevents.js - обработка событий от мыши
pixi.core.js - основная часть отвечающая за рендер Pixi
pixi.extended.js - прототипы для доп методов к PIXI (сейчас там один, рисующий "бегущий" пунктир)
radslider.js - микрокомпонент кругового срайдера (используется для изменения направления градиента)
shapes.js - все что касается расширенного редактора изображений (рисование шейпов и т.д.)
tools.js - все что касается панели инструментов (в текущей версии отключено)

Это общая краткая инфа по структуре проекта - детали в папках( искать такие же файлы readme.md ) и\или в комментариях к модулям




